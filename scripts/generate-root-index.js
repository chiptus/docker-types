#!/usr/bin/env node

import { readFileSync, writeFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __dirname = dirname(fileURLToPath(import.meta.url));
const rootDir = join(__dirname, '..');

// Read package.json to get current version
const pkgPath = join(rootDir, 'package.json');
const pkg = JSON.parse(readFileSync(pkgPath, 'utf-8'));

// Extract Docker API version from package version
// Example: "1.48.0" -> "1.48"
const versionParts = pkg.version.split('.');
const major = versionParts[0];
const minor = versionParts[1];
const dockerApiVersion = `${major}.${minor}`;

// Generate index.ts content
const indexContent = `/*
 * Auto-generated root-level exports for docker-types package v${pkg.version}
 * This file re-exports all types from Docker API version ${dockerApiVersion}
 *
 * DO NOT EDIT MANUALLY - Generated by scripts/generate-root-index.js
 */

export * from './generated/${dockerApiVersion}/index.ts';
`;

// Write index.ts to root directory
const indexPath = join(rootDir, 'index.ts');
writeFileSync(indexPath, indexContent, 'utf-8');

console.log(`âœ“ Generated index.ts for Docker API version ${dockerApiVersion} (package v${pkg.version})`);
